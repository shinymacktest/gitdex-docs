---
title: "File Management UI"
description: "Details on the user interface for viewing, managing, and interacting with uploaded files."
sidebar_position: 32
---
 # File Management UI

The File Management UI provides users with a comprehensive interface to view, manage, and interact with their uploaded files. This section delves into the architecture and components that power these functionalities, including file listing, detailed analytics, and management options.

## File Listing and Overview

The main entry point for managing files is handled by `src/app/uploadedfiles/page.jsx`. This page is responsible for authenticating the user, fetching all their uploaded files from the Supabase database, and then presenting them in a categorized manner using a tabbed interface.

Upon successful authentication, files are fetched and categorized into "Active" and "Inactive" based on their `is_active` status. Each file is then rendered using either the `FileCard` or `InactiveFileCard` component, providing a visual representation and interaction options.

### File Listing Flow

This diagram illustrates the primary flow for displaying a user's uploaded files:





```mermaid
graph TD
    A["User Accesses Uploaded Files Page"] --> B{"Authentication Check"};
    B -->| "Not Authenticated" | C["Redirect to Login"];
    B -->| "Authenticated" | D["Fetch Files from Supabase"];
    D --> E{"Error Fetching Files?"};
    E -->| "Yes" | F["Display Error Message"];
    E -->| "No" | G["Filter Files (Active / Inactive)"];
    G --> H["Render Tabs (Active / Inactive)"];
    H --> I["Display Active Files in Grid"];
    H --> J["Display Inactive Files in Grid"];
    I --> K["FileCard Component"];
    J --> L["InactiveFileCard Component"];
    K --> M["File Options"];
    L --> M;
```



### Main File Listing Page (`src/app/uploadedfiles/page.jsx`)

This component orchestrates the display of all user files. It utilizes Next.js's server components for data fetching and Kinde for authentication.

```jsx
// src/app/uploadedfiles/page.jsx
import FileCard from "@/components/filecard/Filecard";
import InactiveFileCard from "@/components/filecard/InactiveFileCard";
import { getKindeServerSession } from "@kinde-oss/kinde-auth-nextjs/server";
import { supabase } from "@/lib/supabase";
import { Card } from "@/components/ui/card";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";

export const dynamic = "force-dynamic";

export default async function Uploadedfiles() {
  const { getUser } = getKindeServerSession();
  const user = await getUser();

  if (!user) {
    // ... Redirect or display login message
  }

  const { data: files, error } = await supabase
    .from("files")
    .select("*")
    .eq("user_id", user.id)
    .order("created_at", { ascending: false });

  // ... Error handling and empty state display

  const activeFiles = files.filter((file) => file.is_active);
  const inactiveFiles = files.filter((file) => !file.is_active);

  return (
    <main /* ... */ >
      {/* ... UI elements */}
      <Tabs defaultValue="active" className="w-full">
        <TabsList /* ... */ >
          <TabsTrigger value="active">Active Files</TabsTrigger>
          <TabsTrigger value="inactive">Inactive Files</TabsTrigger>
        </TabsList>

        <TabsContent value="active">
          <Card className="p-6 backdrop-blur-lg ">
            {activeFiles.length > 0 ? (
              <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 auto-rows-fr">
                {activeFiles.map((file) => (
                  <FileCard key={file.id} file={file} />
                ))}
              </div>
            ) : (
              <p className="text-center text-gray-500 py-8">No active files.</p>
            )}
          </Card>
        </TabsContent>

        <TabsContent value="inactive">
          {/* ... Inactive files rendering */}
        </TabsContent>
      </Tabs>
    </main>
  );
}
```
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/app/uploadedfiles/page.jsx)

### File Card Component (`src/components/filecard/Filecard.jsx`)

The `FileCard` component is responsible for rendering an individual file's preview and basic information. It dynamically generates a thumbnail based on the file type, supporting images, PDFs, videos, and displaying appropriate icons for other file formats.

```jsx
// src/components/filecard/Filecard.jsx
import { Card, CardContent } from "../ui/card";
import Options from "./Options";
import {
  FileText, FileSpreadsheet, FileCode, FileVideo,
  FileImage, FileJson, FileArchive, FileAudio, File
} from "lucide-react";

export default function FileCard({ file }) {
  const getThumbnail = () => {
    // Logic to determine thumbnail based on file.file_name extension
    const ext = file.file_name.split(".").pop().toLowerCase();

    if (["jpg", "jpeg", "png", "gif", "webp"].includes(ext)) {
      return (
        <img
          src={file.file_url}
          alt={file.file_name}
          className="object-cover w-full h-full"
        />
      );
    }
    // ... other preview types (PDF, Video)

    // Fallback for other file types with Lucide icons
    const getFileTypeInfo = () => { /* ... */ };
    const { icon, label, color } = getFileTypeInfo();

    return (
      <div className="flex flex-col items-center justify-center w-full h-full bg-gradient-to-b from-gray-50 to-gray-100">
        <div className={color}>
          {icon}
        </div>
        <p className="text-sm font-medium text-gray-600">{label}</p>
        <p className="text-xs text-gray-400 mt-1">{ext.toUpperCase()}</p>
      </div>
    );
  };

  return (
    <Card className="w-full mt-0 pt-0 overflow-hidden">
      <CardContent className="p-0 h-full flex flex-col">
        <div className="h-48 flex items-center justify-center overflow-hidden">
          {getThumbnail()}
        </div>
        <h4 className="px-3 py-2 truncate text-sm font-medium">{file.file_name}</h4>
        <div className="mt-auto border-t p-3">
          <Options file={file} />
        </div>
      </CardContent>
    </Card>
  );
}
```
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/components/filecard/Filecard.jsx)

## File Analytics and Management

For an in-depth view and configuration of a specific file, users navigate to `src/app/uploadedfiles/[id]/page.jsx`. This dynamic route provides detailed analytics and editing capabilities for an individual file.

The page performs several critical actions:
1.  **Authentication and Authorization:** Ensures the user is logged in and is the owner of the requested file.
2.  **Data Fetching:** Retrieves file details from Supabase and real-time analytics (views, downloads, last access) from Redis.
3.  **Component Rendering:** Displays the file preview, analytics overview, and editing options using specialized components: `Preview`, `Analytics`, and `Editanalytics`.

### File Analytics Page Logic (`src/app/uploadedfiles/[id]/page.jsx`)

```jsx
// src/app/uploadedfiles/[id]/page.jsx
import Analytics from "@/components/analyticsContol/Analytics";
import Preview from "@/components/analyticsContol/Preview";
import Editanalytics from "@/components/analyticsContol/Editanalytics";
import { getKindeServerSession } from "@kinde-oss/kinde-auth-nextjs/server";
import { supabase } from "@/lib/supabase";
import { redirect } from "next/navigation";
import { redis } from "@/lib/redis"; // Redis client for analytics

export const revalidate = 10; // Revalidate data every 10 seconds

export default async function FileAnalyticsPage({ params }) {
  const { id } = await params;
  const { getUser } = getKindeServerSession();
  const user = await getUser();

  if (!user) {
    redirect("/api/auth/login"); // Redirect if not logged in
  }

  const { data: file, error } = await supabase
    .from("files")
    .select("*")
    .eq("id", id)
    .single();

  if (error || !file || file.user_id !== user.id) {
    // Handle error or unauthorized access
    redirect("/uploadedfiles");
  }

  const [views, downloads, lastAccess] = await Promise.all([
    redis.get(`file:${id}:views`),
    redis.get(`file:${id}:downloads`),
    redis.get(`file:${id}:lastAccess`),
  ]);

  return (
    <main /* ... */ >
      <div className="flex flex-col items-center text-center space-y-4 mb-8">
        <h1 className="text-4xl font-bold tracking-tight">{file.file_name}</h1>
        <p className="text-lg text-gray-500">File Analytics and Management</p>
      </div>

      <Card className="mb-8">
        <div className="grid grid-cols-1 md:grid-cols-2 gap-8 p-6">
          <div className="bg-gray-50 rounded-lg p-6 flex items-center justify-center min-h-[300px]">
            <Preview file={file} />
          </div>
          <div className="space-y-6">
            <h2 className="text-2xl font-semibold mb-2">Analytics Overview</h2>
            <Analytics
              views={Number(views) || 0}
              downloads={Number(downloads) || 0}
              lastAccess={lastAccess}
              file={file}
            />
          </div>
        </div>
      </Card>

      <Card className="p-6">
        <h2 className="text-2xl font-semibold mb-2">Manage Settings</h2>
        <Editanalytics file={file} />
      </Card>
    </main>
  );
}
```
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/app/uploadedfiles/%5Bid%5D/page.jsx)

## File Options and Actions

The `Options` component (`src/components/filecard/Options.jsx`) provides the interactive controls for each file. These actions include copying the file's public URL, initiating a download, and deleting the file.

### File Options Component (`src/components/filecard/Options.jsx`)

This client-side component handles user interactions such as copying a shareable URL, initiating a file download, and deleting a file. It uses `sonner` for toast notifications and an `axios` instance for API calls.

```jsx
// src/components/filecard/Options.jsx
"use client";
import { useState } from "react";
import api from "@/lib/axios"; // Axios instance for API calls
import { Button } from "../ui/button";
import { toast } from "sonner"; // Toast notifications
import Link from "next/link";

export default function Options({ file }) {
  const [loading, setLoading] = useState(false);

  const handleDelete = async () => {
    setLoading(true);
    try {
      await api.delete("/file", {
        data: { file_id: file.id, file_key: file.file_key },
      });
      toast.success("File deleted successfully");
      window.location.reload(); // Reload to reflect changes
    } catch (err) {
      console.error(err);
      toast.error("Error deleting file");
    } finally {
      setLoading(false);
    }
  };

  const handleCopy = async () => {
    try {
      const link = `${window.location.origin}/public/${file.id}`;
      await navigator.clipboard.writeText(
        `Here is the link to access your file: ${link}\nPassword: ${file.file_password}`
      );
      toast.success("Link copied to clipboard");
    } catch (err) {
      console.error(err);
      toast.error("Error copying URL");
    }
  };

  const handleDownload = async () => {
    try {
      const link = document.createElement("a");
      link.href = file.file_url;
      link.download = file.file_name; // Suggest file name for download
      link.click();
      toast.success("Download started");
    } catch (err) {
      console.error(err);
      toast.error("Error downloading file");
    }
  };

  return (
    <div className="flex flex-wrap gap-2">
      <Button variant="outline" size="sm" onClick={handleCopy} disabled={loading}>
        Copy URL
      </Button>
      <Button variant="secondary" size="sm" onClick={handleDownload} disabled={loading}>
        Download
      </Button>
      <Button variant="destructive" size="sm" onClick={handleDelete} disabled={loading}>
        {loading ? "Deleting..." : "Delete"}
      </Button>
      <Link href={`/uploadedfiles/${file.id}`} className="flex">
        <Button size="sm" variant="default" className="bg-indigo-600 hover:bg-indigo-700">
          Analytics & Edit
        </Button>
      </Link>
    </div>
  );
}
```
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/components/filecard/Options.jsx)

### File Action Flow

This diagram outlines the process a user follows when interacting with the file options.





```mermaid
graph TD
    A["User Clicks File Option"] --> B{"Option Selected"};
    B -->| "Copy URL" | C["Construct Public Link"];
    C --> D["Copy Link to Clipboard"];
    B -->| "Download" | E["Create Download Link"];
    E --> F["Initiate Browser Download"];
    B -->| "Delete" | G["Show Loading State"];
    G --> H["API Call to Delete File"];
    H --> I{"Deletion Success?"};
    I -->| "Yes" | J["Display Success Toast"];
    J --> K["Reload Page (Client-Side)"];
    I -->| "No" | L["Display Error Toast"];
    B -->| "Analytics & Edit" | M["Navigate to /uploadedfiles/[id]"];
```



## Key Integration Points

The File Management UI seamlessly integrates several technologies to provide a robust user experience:

*   **Next.js Server Components:** Utilized in `src/app/uploadedfiles/page.jsx` and `src/app/uploadedfiles/[id]/page.jsx` for efficient data fetching and server-side rendering, improving initial load times and SEO.
*   **Kinde Authentication:** Handles user login and session management, ensuring only authenticated and authorized users can access and manage their files.
*   **Supabase:** Serves as the primary database for storing file metadata. Files are fetched, filtered, and managed through Supabase queries.
*   **Redis:** Employed for real-time analytics data (views, downloads, last access) for individual files, providing quick retrieval of frequently accessed metrics.
*   **Shadcn/ui Components:** Provides a consistent and accessible UI foundation with components like `Card`, `Tabs`, and `Button`.
*   **Lucide React Icons:** Used in `FileCard` to dynamically display visually distinct icons for various file types, enhancing user understanding at a glance.
*   **Axios:** Manages API calls for file operations like deletion, ensuring robust client-server communication.
*   **Sonner:** Delivers user-friendly, non-blocking toast notifications for actions like copying URLs or file deletions.

This architecture ensures a responsive, secure, and data-rich environment for users to manage their uploaded content.

---

Next: [Core Components and Utilities](./4_core-components-utilities.mdx)