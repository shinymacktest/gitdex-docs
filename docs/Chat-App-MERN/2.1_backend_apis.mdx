---
title: "Backend APIs"
description: "Documentation of the backend REST APIs."
---

# Backend APIs

<TOC />

## Authentication APIs

This section details the REST APIs responsible for user authentication and authorization.  The authentication flow utilizes JWT (JSON Web Tokens) for secure session management and incorporates both email/password and Google OAuth 2.0 login options.

### `/signup` (POST)

This endpoint handles user registration.

**Request:**

*   `username` (string, 3-20 characters): The user's chosen username.
*   `email` (string): The user's email address.
*   `password` (string, min 6 characters): The user's password.


**Response (201 Created):**

*   `_id` (string): The user's unique ID.
*   `username` (string): The user's username.
*   `email` (string): The user's email address.
*   `profilePic` (string, optional): URL of the user's profile picture.
*   `authProvider` (string): 'email'


**Response (400 Bad Request):**  Returned if any validation rules fail, or if the email or username already exists.

**Code Snippet:**

```javascript
export const signup = async (req, res) => {
    const { username, email, password } = req.body;
    try {
        // Validate input fields
        if (!username || !email || !password) {
            return res.status(400).json({ message: "Please fill in all fields." });
        }
        // ... (rest of the validation and user creation logic) ...
        const salt = await bcrypt.genSalt(10);
        const hashedPassword = await bcrypt.hash(password, salt);
        const newUser = new User({ username, email, password: hashedPassword, authProvider: 'email' });
        //generate jwt token here
        generateToken(newUser._id, res);
        await newUser.save();
        // ... (rest of the response handling) ...
    } catch (error) {
        // ... (error handling) ...
    }
};
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/controllers/auth.controller.js)

### `/login` (POST)

This endpoint handles user login using email and password.

**Request:**

*   `email` (string): The user's email address.
*   `password` (string): The user's password.


**Response (200 OK):**  Similar to `/signup` response, including a JWT in the response cookie.

**Response (400 Bad Request):** Returned if the email or password is incorrect.


**Code Snippet:**

```javascript
export const login = async (req, res) => {
    const { email, password } = req.body;
    try {
        const user = await User.findOne({ email });
        if (!user) {
            return res.status(400).json({ message: "Invalid credentials." });
        }
        // Check if it's a Google user and password is not set
        if(user.authProvider === 'google' && !user.password){
            return res.status(400).json({ message: "Please sign in with Google." });
        }
        const isPasswordCorrect = await bcrypt.compare(password, user.password);
        if (!isPasswordCorrect) {
            return res.status(400).json({ message: "Invalid credentials." });
        }
        generateToken(user._id, res);
        // ... (rest of the response handling) ...
    } catch (error) {
        // ... (error handling) ...
    }
};
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/controllers/auth.controller.js)

### `/logout` (POST)

This endpoint logs the user out by clearing the JWT cookie.

**Response (200 OK):**  Indicates successful logout.

### `/check` (GET)

This endpoint checks the authentication status of the user.  Requires authentication; only accessible with valid JWT.

**Response (200 OK):** User details if authenticated.

**Response (500 Internal Server Error):** Any internal server error.



### `/update-profile` (PUT)

This endpoint allows users to update their profile information, including their profile picture and username.  Requires authentication.

**Request:**

*   `profilePic` (string, optional): Base64 encoded image data or a URL.
*   `username` (string, optional): The new username.



**Response (200 OK):** Updated user information.


**Response (400 Bad Request):** If the username validation fails or is already taken.

**Code Snippet:**
```javascript
export const updateProfile = async (req, res) => {
    try {
        const { profilePic, username } = req.body;
        const userId = req.user._id;
        let userToUpdate = await User.findById(userId);
        // ... (rest of validation and update logic) ...
        const fieldsToUpdate = {};
        let newUsername = username ? username.trim() : null;
        if (newUsername && newUsername !== userToUpdate.username) {
            // Validate new username
            // ... (validation code) ...
            fieldsToUpdate.username = newUsername;
        }
        // Handle profile picture update
        if (profilePic) {
            const uploadResponse = await cloudinary.uploader.upload(profilePic);
            fieldsToUpdate.profilePic = uploadResponse.secure_url;
        }
        if (Object.keys(fieldsToUpdate).length === 0) {
            return res.status(400).json({ message: "No changes provided to update." });
        }
        const updatedUser = await User.findByIdAndUpdate(userId, { $set: fieldsToUpdate }, { new: true });
        generateToken(updatedUser._id, res); // refresh token after update
        res.status(200).json(updatedUser);
    } catch (error) {
        // ... (error handling) ...
    }
};
```
[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/controllers/auth.controller.js)


### Google OAuth 2.0 Integration

The application supports Google OAuth 2.0 for user authentication.  The `/google` and `/google/callback` endpoints handle the OAuth flow.  `/google` initiates the Google authentication process and `/google/callback` handles the response from Google after the user authenticates.  This is managed through the `passport.js` library and its Google strategy.


**Code Snippet:**
```javascript
router.get(
    '/google',
    passport.authenticate('google', { scope: ['profile', 'email'] })
);
router.get(
    '/google/callback',
    passport.authenticate('google', {
        failureRedirect: 'http://localhost:5173/login',
        failureMessage: true
    }),
    googleAuthCallback
);

```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/routes/auth.route.js)

### `/username/check/:username` (GET)

This endpoint checks the availability of a username. Requires authentication.

**Response (200 OK):**
*   `available` (boolean):  `true` if the username is available, `false` otherwise.
*   `message` (string): Explanatory message.


### Authentication Flow Diagram

````mermaid
sequenceDiagram
    participant C as Client
    participant S as Server
    C->>S: Signup Request
    S->>C: 201 Created, JWT
    C->>S: Login Request
    S->>C: 200 OK, JWT
    C->>S: Protected Route Request (JWT in header)
    S->>C: 200 OK (Resource)
    C->>S: Logout Request
    S->>C: 200 OK
```

## Friend Management APIs

These APIs handle friend requests and managing friend lists. All endpoints in this section require authentication (`protectRoute` middleware).

### File Structure Diagram

````mermaid
graph TD
    A[backend] --> B(src);
    B --> C(routes);
    B --> D(controllers);
    B --> E(middleware);
    C --> F(friend.route.js);
    D --> G(friend.controller.js);
    E --> H(auth.middleware.js);

```


###  `/request/send/` (POST)

Sends a friend request to another user.

### `/request/accept/:senderId` (POST)

Accepts a friend request.

### `/request/reject/:senderId` (POST)

Rejects a friend request.

### `/remove/:friendId` (DELETE)

Removes a friend from the user's friend list.

### `/list` (GET)

Retrieves the list of the user's friends.

### `/requests/pending` (GET)

Retrieves the list of pending friend requests.

### `/requests/sent` (GET)

Retrieves the list of sent friend requests.



## Messaging APIs

These APIs handle sending and retrieving messages between users. All endpoints in this section require authentication.

### `/users` (GET)

Retrieves a list of users for the sidebar.

### `/:id` (GET)

Retrieves messages for a specific conversation.  `id` represents the other user's ID.

### `/send/:id` (POST)

Sends a message to a specific user.  `id` represents the recipient's ID.

Next: [Backend Database and Models](./2.2_backend_database.mdx)