---
title: "Frontend State Management"
description: "Explanation of the application's state management using Zustand."
---

# Frontend State Management

<TOC />

This document details the frontend state management implemented using Zustand in the chat application.  Zustand is a small, fast, and scalable state-management solution that leverages hooks for a seamless integration with React.  We use it to manage authentication, chat messages, user lists, friend requests, and the application theme.

## Zustand Store Structure

The application utilizes three separate Zustand stores: `useAuthStore`, `useChatStore`, and `useThemeStore`. Each store manages a distinct aspect of the application's state, promoting modularity and maintainability.  The stores interact minimally, avoiding unnecessary coupling.

````mermaid
graph TD
A[useAuthStore] --> B(Authentication, Socket);
C[useChatStore] --> D(Chat Messages, Users, Friends);
E[useThemeStore] --> F(Theme);
```

### 1. useAuthStore ([Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/store/useAuthStore.js))

This store manages the authentication state, including user information, login/signup status, and socket connection.

```javascript
import { create } from "zustand";
// ... other imports

export const useAuthStore = create((set, get) => ({
    authUser: null,
    isSigningUp: false,
    isLoggingIn: false,
    // ... other state variables

    checkAuth: async () => { /* ... */ },
    signup: async (data) => { /* ... */ },
    logout: async () => { /* ... */ },
    login: async (data) => { /* ... */ },
    updateProfile: async (data) => { /* ... */ },
    connectSocket: () => { /* ... */ },
    disconnectSocket: () => { /* ... */ }
}));
```

*   **State Variables:**  `authUser`, `isSigningUp`, `isLoggingIn`, `isUpdatingProfile`, `isCheckingAuth`, `onlineUsers`, `socket` store information about the currently authenticated user, the status of authentication actions, and the socket connection.
*   **Asynchronous Actions:**  `checkAuth`, `signup`, `logout`, `login`, `updateProfile` handle the interactions with the backend API for authentication and profile management.  These functions use `async/await` for cleaner asynchronous code.  They update the state appropriately using `set` and handle potential errors with `try...catch` blocks.  `connectSocket` and `disconnectSocket` manage the real-time connection using `socket.io-client`.
*   **`get()` function:** The `get()` function allows accessing other state variables within the store, enabling inter-function dependency. For example, `connectSocket` uses `get().authUser` to check if a user is logged in before connecting the socket.

### 2. useChatStore ([Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/store/useChatStore.js))

This store manages the chat functionality, including messages, users, friend requests, and the currently selected user.

```javascript
import { create } from "zustand";
// ... other imports

export const useChatStore = create((set, get) => ({
    messages: [],
    users: [],
    pendingRequests: [],
    sentRequests: [],
    selectedUser: null,
    // ... other state variables

    getFriends: async () => { /* ... */ },
    getPendingRequests: async () => { /* ... */ },
    getSentRequests: async () => { /* ... */ },
    sendFriendRequest: async (identifier) => { /* ... */ },
    acceptFriendRequest: async (senderId) => { /* ... */ },
    rejectFriendRequest: async (senderId) => { /* ... */ },
    removeFriend: async (friendId) => { /* ... */ },
    getMessages: async (userId) => { /* ... */ },
    sendMessage: async (messageData) => { /* ... */ },
    subscribeToMessages: () => {/* ... */},
    unsubscribeFromMessages: () => {/* ... */},
    setSelectedUser: (selectedUser) => set({selectedUser})
}));
```

*   **State Variables:** `messages`, `users`, `pendingRequests`, `sentRequests`, and `selectedUser` store the chat data, user list, friend requests, and the currently selected chat partner.
*   **Asynchronous Actions:**  `getFriends`, `getPendingRequests`, `getSentRequests`, `sendFriendRequest`, `acceptFriendRequest`, `rejectFriendRequest`, `removeFriend`, `getMessages`, and `sendMessage` interact with the backend API to manage friends, friend requests, and messages.  These functions use `async/await` for asynchronous operation, handle errors using `try...catch` blocks, and update the state using `set`.  `subscribeToMessages` and `unsubscribeFromMessages` handle socket.io message subscription.
*   **Data Fetching:**  Functions like `getFriends` and `getMessages` fetch data from the backend and update the relevant state variables.
*   **Inter-Store Communication:**  This store uses `useAuthStore.getState().socket` to access the socket from the `useAuthStore` for real-time message updates.

### 3. useThemeStore ([Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/store/useThemeStore.js))

This store manages the application's theme (light or dark).

```javascript
import { create } from "zustand";

export const useThemeStore = create((set) => ({
    theme: localStorage.getItem("chat-theme") || "dark",
    setTheme: (theme) => {
        localStorage.setItem("chat-theme", theme);
        set({ theme });
    }
}));
```

*   **State Variable:** `theme` stores the current theme, defaulting to "dark" if not found in `localStorage`.
*   **Action:** `setTheme` updates the theme and persists it in `localStorage`. This ensures that the theme is preserved across sessions.


## API Interaction Flow

The following sequence diagram illustrates the interaction flow between the frontend and backend APIs during a login process.

````mermaid
sequenceDiagram
    participant U as User
    participant F as Frontend
    participant B as Backend
    U->>F: Login credentials
    F->>B: POST /auth/login
    activate B
    B-->>F: Authentication Response (Token, User data)
    deactivate B
    F->>F: Update useAuthStore with user data
```

##  Best Practices

*   **Modularity:** Separating state into distinct stores improves code organization and maintainability.
*   **Asynchronous Operations:** Using `async/await` enhances readability and error handling in asynchronous operations.
*   **Error Handling:**  `try...catch` blocks are used consistently to handle potential errors during API interactions.
*   **Data Persistence:** The theme is persisted in `localStorage` to maintain user preference across sessions.
*   **Real-time Updates:** Using `socket.io` enables real-time updates for online users and new messages.


Next: [Deployment and Configuration](./4_deployment.mdx)