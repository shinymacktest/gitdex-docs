---
title: "Data Models and Schema"
description: "Definition of data structures used across the application."
sidebar_position: 22
---
Here's a step-by-step thought process for generating the MDX content:

1.  **Understand the Goal:** Generate DeepWiki-style MDX documentation for data models and schema, focusing on the provided `user.model.js`, `message.model.js`, and `db.js` files. Key requirements include Mermaid diagrams (with strict quoting rules), code snippets with GitHub links, specific structure, and word count.

2.  **Initial Structure & Frontmatter:**
    *   Start with the required frontmatter.
    *   `title: "Data Models and Schema"`
    *   `description: "Definition of data structures used across the application."`
    *   `sidebar_position: 22`
    *   Add the main heading and TOC.

3.  **Analyze `backend/src/lib/db.js`:**
    *   **Purpose:** Connects to MongoDB using Mongoose.
    *   **Key points:** `mongoose.connect`, `process.env.MONGODB_URI`, error handling.
    *   **Snippet Idea:** The `connectDB` function itself.
    *   **Explanation:** How the application connects to its database.

4.  **Analyze `backend/src/models/user.model.js`:**
    *   **Purpose:** Defines the `User` schema.
    *   **Key fields:** `email`, `username`, `password`, `profilePic`, `friends`, `friendRequests`, `sentRequests`, `authProvider`, `googleId`.
    *   **Data Types:** `String`, `ObjectId`, `Array` of `ObjectId`.
    *   **Validation:** `required`, `unique`, `minlength`, `maxlength`, `enum`, `sparse`.
    *   **Pre-save Hook:** Handles `password` for Google auth users and enforces password for email signups. This is important for security and data integrity.
    *   **Snippet Ideas:**
        *   The `userSchema` definition (core fields).
        *   The `friends`, `friendRequests`, `sentRequests` fields (demonstrates relationships).
        *   The `authProvider` and `googleId` fields (for authentication).
        *   The `pre('save')` hook (demonstrates middleware/validation).
    *   **Explanation:** Detailed breakdown of user attributes, relationships, and authentication-related fields.

5.  **Analyze `backend/src/models/message.model.js`:**
    *   **Purpose:** Defines the `Message` schema.
    *   **Key fields:** `senderId`, `receiverId`, `text`, `image`.
    *   **Data Types:** `ObjectId` (references `User`), `String`.
    *   **Validation:** `required`.
    *   **Timestamps:** `timestamps: true` is crucial here for `createdAt` and `updatedAt`.
    *   **Snippet Idea:** The entire `messageSchema` definition.
    *   **Explanation:** How messages are structured, including references to users.

6.  **Plan Mermaid Diagrams:**
    *   **Diagram 1: Overall Database Connection/Model Flow.**
        *   Start with `Application` -> `DB Connection` -> `MongoDB`.
        *   Then show `User Model` and `Message Model` interacting with `MongoDB`.
        *   Need to ensure *all node text is in quotes*.
        *   `graph TD` seems appropriate.
        *   Nodes: `A["Application Runtime"]`, `B["Database Connection (db.js)"]`, `C["MongoDB Atlas"]`, `D["User Model"]`, `E["Message Model"]`.
        *   Connections: `A --> B`, `B --> C`, `D --> C`, `E --> C`. Also `D <--> E` to show implied relationship (messages involve users).

    *   **Diagram 2: User Schema Relationships.**
        *   Focus on how `User` relates to `User` itself (friends, requests).
        *   `flowchart LR` might be good for showing internal structure.
        *   Nodes: `U["User Document"]`, `F["Friends Array"]`, `IR["Incoming Requests"]`, `OR["Outgoing Requests"]`.
        *   Connections: `U --> F`, `U --> IR`, `U --> OR`. Add `F <--> U` to indicate mutual relationship, similarly for requests.
        *   Edge labels *must* be quoted: `U -->|"references User ObjectId"| F`.

7.  **Draft Content - Iteration 1 (Mental or rough notes):**

    *   **Introduction:** Explain what data models are.
    *   **Database Connection:** Discuss `db.js`. Add snippet.
    *   **User Model:** Discuss `user.model.js`. Break down fields, explain relationships (friends, requests). Add multiple snippets. Discuss pre-save hook.
    *   **Message Model:** Discuss `message.model.js`. Explain fields, references. Add snippet.
    *   **Mermaid 1:** Place after database and models introduction.
    *   **Mermaid 2:** Place after detailed User model explanation.
    *   **Key Integration Points:** Summarize how models interact, importance of Mongoose, `ObjectId` references.
    *   **Next link.**

8.  **Refine and Elaborate (Add details, explanations, GitHub links):**

    *   **Snippets:** Ensure ````javascript` and `[View on GitHub](link)` for each. Use approximate line numbers for `backend/src/models/user.model.js` as the full file will be too long for one snippet.
    *   **Mermaid Syntax Check (Crucial!):**
        *   *Self-correction for Diagram 1:* Ensure *all* node text is quoted (`A["Application Runtime"]`).
        *   *Self-correction for Diagram 2:* Ensure *all* node text is quoted (`U["User"]`). Ensure *edge labels* are quoted: `U -->|"friends array"| F`.
    *   **Word Count Check:** Start writing, expanding explanations. If short, add more descriptive text about the *why* behind design choices (e.g., `timestamps: true` for audit, `ObjectId` for relationships, `enum` for `authProvider`).
    *   **DeepWiki Style:** Use clear headings, bullet points, and concise language.

9.  **Final Review:**
    *   Check all requirements: MDX structure, frontmatter, heading, TOC, snippets, GitHub links, 1-2 Mermaids (with *all* node text quoted), word count, next link.
    *   Read through for clarity, grammar, and consistency.
    *   Verify all Mermaid nodes have quoted text. This is the most common error point.

**(Self-correction during Mermaid syntax validation):**
*Initial thought for an edge label might be `C --> : "Accesses MongoDB" D`.*
*Correction:* This is incorrect. The label *must* be part of the arrow syntax `C -->|"Accesses MongoDB"| D`. All text within the quotes must be quoted too.

This systematic approach helps ensure all constraints are met, especially the tricky Mermaid quoting rule.