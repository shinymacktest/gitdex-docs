---
title: "Backend Architecture"
description: "Detailed explanation of the backend components and functionalities."
---
# Backend Architecture

<TOC />

## Authentication Middleware

The backend uses middleware to protect routes requiring authentication.  The `protectRoute` middleware verifies JWTs (JSON Web Tokens) from cookies.

```javascript
// backend/src/middleware/auth.middleware.js
import jwt from "jsonwebtoken"
import User from "../models/user.model.js"

export const protectRoute = async (req, res, next) => {
    try {
        // ... (JWT verification logic) ...
    } catch (error) {
        // ... (Error handling) ...
    }
};
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/middleware/auth.middleware.js)

## User Model

The `User` model defines the structure of user data stored in MongoDB.  It includes fields for email, username, password, profile picture, friends list, and friend requests.

```javascript
// backend/src/models/user.model.js
import mongoose from "mongoose"

const  userSchema = new mongoose.Schema(
    {
        email: { type: String, required: true, unique: true },
        username: { type: String, required: true, unique: true, ... },
        password: { type: String, minlength: 6 },
        // ... other fields ...
    },
    { timestamps: true } 
);

// ... (rest of the model) ...
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/models/user.model.js)


## Real-time Communication with Socket.IO

Socket.IO is used for real-time messaging.  The `socket.js` file manages socket connections, user mapping, and emitting events.

```javascript
// backend/src/lib/socket.js
import { Server } from "socket.io";
// ...
const userSocketMap = {}; // {userId: socketId}
io.on("connection", (socket) => {
    // ... (Connection and disconnection handling) ...
});
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/lib/socket.js)

Next: [3_frontend.mdx]