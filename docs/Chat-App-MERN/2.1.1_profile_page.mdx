---
title: "Profile Page"
description: "Detailed documentation for the user profile page, including profile picture and username updates."
---
<TOC />

# Profile Page

The `ProfilePage` component ([Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/pages/ProfilePage.jsx)) serves as the central hub for users to view and manage their personal information within the application. It allows users to update their profile picture and modify their username, complete with real-time availability checks.

## Component Overview

This page displays the user's profile picture, username, email address, and account creation details. Key features include:

*   **Profile Picture Management**: Users can upload a new profile picture, which is then updated instantly.
*   **Username Editing**: An interactive input field allows users to change their username, featuring a debounced availability check against the backend to ensure uniqueness.
*   **Account Information**: Displays static details like "Member Since" and "Account Status".

The component leverages Zustand for global state management (`useAuthStore`), `lucide-react` for icons, `react-hot-toast` for notifications, and an `axiosInstance` for API interactions.

### State Management

The component manages several local states using `useState`:

*   `selectedImg`: Stores the base64 URL of a newly selected image before it's persisted, or `null`.
*   `isEditingUsername`: A boolean that toggles the username field between display and edit modes.
*   `newUsername`: Stores the value of the username input field during editing.
*   `usernameStatus`: An object (`{ checking: boolean, available: boolean, message: string }`) to manage the feedback shown to the user during username availability checks.

It also interacts with the global `useAuthStore` to access the `authUser` object (containing `username`, `email`, `profilePic`, `createdAt`) and to call the `updateProfile` action, which handles API calls to update user data.

```javascript
// frontend/src/pages/ProfilePage.jsx
import { useState, useEffect, useRef } from "react";
import { useAuthStore } from "../store/useAuthStore";
import { Camera, Mail, User, Edit, Save, X, Loader2 } from "lucide-react";
import toast from "react-hot-toast";
import { axiosInstance } from "../lib/axios"; // Assuming you have this configured instance

const ProfilePage = () => {
	const { authUser, isUpdatingProfile, updateProfile } = useAuthStore();
	const [selectedImg, setSelectedImg] = useState(null);

	const [isEditingUsername, setIsEditingUsername] = useState(false);
	const [newUsername, setNewUsername] = useState(authUser?.username || "");
	const [usernameStatus, setUsernameStatus] = useState({
		checking: false,
		available: true,
		message: "",
	});
	const debounceTimeout = useRef(null);
    // ... rest of the component
};
```
[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/pages/ProfilePage.jsx)

## Profile Picture Update

Users can update their profile picture by clicking on the camera icon overlaying their current profile image.

### Process Flow

1.  **File Selection**: Clicking the camera icon opens a file input dialog.
2.  **Image Reading**: Once a file is selected, `FileReader` reads the image as a Data URL (base64).
3.  **Local Preview**: The `selectedImg` state is updated, providing an immediate visual preview.
4.  **API Update**: The `updateProfile` action from `useAuthStore` is dispatched with the base64 image, triggering an API call to persist the new profile picture on the backend.
5.  **Loading Indicator**: The camera icon displays an `animate-pulse` effect and becomes `pointer-events-none` while `isUpdatingProfile` is true, indicating an ongoing upload.

```javascript
// frontend/src/pages/ProfilePage.jsx
const handleImageUpload = async (e) => {
    const file = e.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.readAsDataURL(file);

    reader.onload = async () => {
        const base64Image = reader.result;
        setSelectedImg(base64Image);
        await updateProfile({ profilePic: base64Image });
    };
};
```
[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/pages/ProfilePage.jsx#L28-L41)

## Username Editing and Availability Check

The username field dynamically switches between a read-only display and an editable input. When in edit mode, the component implements a debounced check to verify username availability in real-time.

### Username Update Flow

<!-- Fixed Mermaid syntax -->
````mermaid
sequenceDiagram
    participant U as User
    participant PP as ProfilePage
    participant BE as Backend API

    U->>PP: Clicks "Edit" username button
    PP->>PP: Sets isEditingUsername = true; Displays input
    U->>PP: Types new username "new_user"
    PP->>PP: Updates newUsername state
    PP->>PP: Clears existing debounce timer (if any)
    PP->>PP: Starts new debounce timer (e.g., 500ms)
    Note over PP: (If newUsername changes rapidly, timer resets)
    PP-->>PP: Debounce timer expires
    PP->>BE: GET /auth/username/check/new_user
    BE-->>BE: Checks database for username
    BE-->>PP: Response: { available: true/false, message: "..." }
    PP->>PP: Updates usernameStatus state
    PP-->>U: Displays availability message (e.g., "Available" or "Taken")

    alt On Save
        U->>PP: Clicks "Save" button
        PP->>PP: Validates usernameStatus (must be available and changed)
        PP->>PP: Calls updateProfile({ username: "new_user" })
        PP->>BE: POST /api/users/update-profile (or similar)
        BE-->>PP: Response: Success/Error
        PP-->>U: Displays toast notification
        PP->>PP: Sets isEditingUsername = false; Resets state
    else On Cancel
        U->>PP: Clicks "Cancel" button
        PP->>PP: Sets isEditingUsername = false; Resets newUsername to original
    end
```

### Debounced Availability Check

The `useEffect` hook, combined with `useRef` for `debounceTimeout`, implements a debounced API call to `/auth/username/check/:username`. This prevents excessive network requests as the user types.

*   The effect runs whenever `newUsername` or `authUser.username` changes.
*   It clears any pending timeout to reset the debounce.
*   Basic client-side validation for username length is performed.
*   If the `newUsername` is the same as the `authUser.username`, no check is needed.
*   After a 500ms delay, an API call is made to the backend to check availability.
*   The `usernameStatus` state updates dynamically to show "Checking...", "Available", or an error message.

```javascript
// frontend/src/pages/ProfilePage.jsx
useEffect(() => {
    clearTimeout(debounceTimeout.current);

    if (!newUsername.trim() || newUsername.trim().length < 3) {
        setUsernameStatus({ checking: false, available: false, message: "Must be 3+ characters." });
        return;
    }

    if (newUsername === authUser.username) {
        setUsernameStatus({ checking: false, available: true, message: "" });
        return;
    }

    setUsernameStatus((prev) => ({ ...prev, checking: true, message: "Checking..." }));

    debounceTimeout.current = setTimeout(async () => {
        try {
            const res = await axiosInstance.get(`/auth/username/check/${newUsername}`);
            setUsernameStatus({
                checking: false,
                available: res.data.available,
                message: res.data.message,
            });
        } catch (error) {
            const message = error.response?.data?.message || "Error checking username.";
            setUsernameStatus({ checking: false, available: false, message });
        }
    }, 500);

    return () => clearTimeout(debounceTimeout.current);
}, [newUsername, authUser.username]);
```
[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/frontend/src/pages/ProfilePage.jsx#L44-L79)

### Saving and Cancelling Username Changes

*   `handleSaveUsername`: Called when the "Save" button is clicked. It ensures the username is available and different from the current one before calling `updateProfile`.
*   `handleCancelEdit`: Resets `isEditingUsername` to `false` and `newUsername` to the original `authUser.username`, discarding any changes.

This comprehensive profile page provides a robust and user-friendly experience for managing personal account details.