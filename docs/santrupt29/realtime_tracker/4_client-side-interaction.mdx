---
title: "Client-Side Interaction"
description: "How user interactions are handled and managed within the frontend."
sidebar_position: 4
---
# Client-Side Interaction

This section details how user interactions are managed within the frontend of the Realtime Tracker application, focusing on geolocation tracking and real-time map updates.

## User Location Tracking and Emission

The `script.js` file handles the client-side logic for obtaining user location and communicating it to the server. It leverages the browser's `navigator.geolocation` API to continuously track the user's position.

When the user's location is successfully obtained, it's emitted to the server via a WebSocket connection using the `'sendLocation'` event. This event carries the username, latitude, and longitude of the user. The `userPath` array stores a history of the user's coordinates, which is used to draw a polyline representing their movement on the map.

```javascript
const socket = io();

const username = prompt("Enter your Username");

// User Location History
const userPath = [];
// Check if browser supports geolocation
if (navigator.geolocation) {
    navigator.geolocation.watchPosition((position) => {
        const { latitude, longitude } = position.coords;
        socket.emit('sendLocation', {username, latitude, longitude });
        userPath.push([latitude, longitude]);
        if (userPath.length > 1) {
            const polyline = L.polyline(userPath, { color: 'red' }).addTo(map); // Route
        }
    }, (error) => {
        console.log(error);
    }, {
        enableHighAccuracy: true,
        timeout: 5000,
        maximumAge: 0,
    });
}
```

## Map Initialization and Real-time Updates

The application utilizes the Leaflet.js library to display an interactive map. The map is initialized with a set of tiles from OpenStreetMap and initially centered at `[0, 0]` with a zoom level of 10.

The client listens for two types of WebSocket events from the server:

*   **`receiveLocation`**: When this event is received, it indicates that another user has updated their location. The client updates the map by either creating a new marker for the user or moving an existing marker to the new coordinates. The marker is bound with the username for identification.
*   **`userDisconnected`**: This event signals that a user has disconnected. The corresponding marker is removed from the map.

```javascript
const map = L.map("map").setView([0, 0], 10);

L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
    attribution: "Â© OpenStreetMap contributors",
}).addTo(map);

const markers = {};

socket.on("userDisconnected", (id) => {
    if (markers[id]) {
        map.removeLayer(markers[id]);
        delete markers[id];
    }
});
socket.on("receiveLocation", (data) => {
    const { id, username, latitude, longitude } = data;
    map.setView([latitude, longitude]);
    if (!markers[id]) {
        markers[id] = L.marker([latitude, longitude])
        .bindPopup(username)
        .addTo(map)
        .openPopup();
    } else {
        markers[id].setLatLng([latitude, longitude]).bindPopup(username).openPopup();
    }
});
```

## Server-Side Event Handling

The `app.js` file on the server-side sets up the Express server and integrates Socket.IO for real-time communication. It listens for incoming WebSocket connections.

Upon a new connection, the server sets up event listeners for the client:

*   **`sendLocation`**: When a client emits this event, the server receives the location data, logs it, and then broadcasts it to all connected clients using `io.emit("receiveLocation", ...)`. This ensures all users see the updated location of others.
*   **`disconnect`**: When a client disconnects, the server emits a `userDisconnected` event to all other clients, along with the `socket.id` of the disconnected user, allowing them to be removed from the map.

```javascript
io.on("connection", function (socket) {
    socket.on('sendLocation', function (data) {
        console.log(data);
        io.emit("receiveLocation", {id: socket.id, ...data});
    });

    socket.on('disconnect', function () {
        io.emit("userDisconnected", socket.id);
    }
    );
  console.log('Connected');
});
```

## Key Takeaways

*   User interactions, specifically location updates, are handled by the browser's `navigator.geolocation` API.
*   Socket.IO is used for real-time, bidirectional communication between the client and server.
*   The client emits location data to the server, which then broadcasts it to all connected clients for map synchronization.
*   Markers are dynamically managed on the map to represent the real-time positions of connected users.