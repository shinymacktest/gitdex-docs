---
title: "Authentication and User Management"
description: "Information on user registration, authentication flow, and session management using KindeAuth."
sidebar_position: 31
---
 # Authentication and User Management

Authentication and user management in Track Vault are handled primarily through KindeAuth, a robust authentication service, integrated with Supabase for user data persistence. This document outlines the core components and flows involved in registering, authenticating, and managing users within the application.

## KindeAuth Integration

Track Vault leverages KindeAuth for its authentication backbone, providing secure and streamlined user login, registration, and session management. The integration involves both client-side and server-side components to ensure a seamless experience.

### KindeProvider Setup

The client-side integration begins with the `KindeProvider` component, which wraps the application to provide authentication context to all child components. This provider is configured with environment variables to connect to your specific KindeAuth application.

```jsx
// src/components/Provider.jsx
"use client";
import { KindeProvider } from "@kinde-oss/kinde-auth-nextjs";

export function Providers({ children }) {
  return (
    <KindeProvider
      clientId={process.env.NEXT_PUBLIC_KINDE_CLIENT_ID}
      domain={process.env.NEXT_PUBLIC_KINDE_DOMAIN}
      redirectUri={process.env.NEXT_PUBLIC_KINDE_REDIRECT_URI}
      logoutUri={process.env.NEXT_PUBLIC_KINDE_LOGOUT_URI}
    >
      {children}
    </KindeProvider>
  );
}
```
The `Providers` component ensures that the entire application has access to KindeAuth's client-side functionalities, such as managing user sessions and retrieving authentication state. The environment variables (`NEXT_PUBLIC_KINDE_CLIENT_ID`, `NEXT_PUBLIC_KINDE_DOMAIN`, etc.) are critical for connecting to the correct KindeAuth instance.
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/components/Provider.jsx)

### KindeAuth API Route

KindeAuth provides a convenient `handleAuth` function to manage all authentication-related API routes (login, register, logout, callback). This is typically set up as a catch-all route in Next.js.

```javascript
// src/app/api/auth/[kindeAuth]/route.js
import {handleAuth} from "@kinde-oss/kinde-auth-nextjs/server";

export const GET = handleAuth();
```
This single file handles all incoming requests to `/api/auth/*` and directs them to the appropriate KindeAuth handler, simplifying the server-side authentication setup.
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/app/api/auth/[kindeAuth]/route.js)

## User Registration and Data Persistence

After a user successfully authenticates with KindeAuth, their profile information needs to be stored in the application's database (Supabase in this case) to maintain a persistent record and associate them with application-specific data.

### Supabase User Registration

The `src/app/api/register/route.js` endpoint is responsible for taking the authenticated user's details from KindeAuth and "upserting" them into the Supabase `users` table. An upsert operation either inserts a new record or updates an existing one if a conflict (e.g., duplicate email) is detected.

```javascript
// src/app/api/register/route.js
import { supabase }  from "@/lib/supabase";
import { getKindeServerSession } from "@kinde-oss/kinde-auth-nextjs/server";
import { NextRequest , NextResponse } from "next/server";

export async function POST() {
  const { getUser } = getKindeServerSession();
  const user = await getUser();

  if (user) {
    // Try inserting into Supabase if not exists
    const { data, error } = await supabase
      .from("users")
      .upsert({
        email: user.email,
        name: user.given_name + " " + user.family_name,
        auth_user_id: user.id
      }, { onConflict: "email" });

    if (error) {
      console.error("Supabase error:", error.message);
    } else {
      console.log("User registered:", data);
    }
  }

  return NextResponse.json(user) ;
}
```
This API route is designed to be called after a successful KindeAuth login or registration. It fetches the user's details from the Kinde session using `getKindeServerSession` and then uses `supabase.from("users").upsert` to store or update their information. The `onConflict: "email"` option is crucial for preventing duplicate user entries based on their email address.
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/app/api/register/route.js)

### Authentication Flow Diagram

The following diagram illustrates the typical authentication and registration flow within Track Vault:





```mermaid
graph TD
    A["User initiates Login/Signup"] -->| "Redirect to KindeAuth" | B["KindeAuth Login Page"]
    B -->| "Successful Authentication" | C["KindeAuth Callback URL"]
    C -->| "KindeAuth Redirects to App" | D["Next.js App (Client)"]
    D -->| "Call /api/register" | E["Next.js API Route (src/app/api/register/route.js)"]
    E -->| "Get Kinde User Session" | F["KindeAuth Server Session"]
    F -->| "Return User Data" | E
    E -->| "Upsert User Data" | G["Supabase 'users' Table"]
    G -->| "Confirm Data Stored" | E
    E -->| "Return User Info to Client" | D
    D -->|"Display User Dashboard"| H["Authenticated Application State"]
```



## Application Information (About Page)

The `src/app/about/page.jsx` file provides general information about Track Vault, including its purpose, key features, and underlying technologies. While not directly involved in authentication, it offers context for the application's overall design and the security considerations that drive the choice of authentication provider.

```jsx
// src/app/about/page.jsx
import Link from "next/link"

export default function About() {
  return (
    <main className="mt-15 max-w-4xl mx-auto px-6 py-12">
      <h1 className="text-4xl font-bold text-gray-900 mb-6">About Track Vault</h1>
      <p className="text-lg text-gray-700 leading-relaxed mb-6">
        <span className="font-semibold">Track Vault</span> is a secure and
        lightweight file sharing platform designed to give users full control
        over how their files are accessed, tracked, and automatically managed.
        Built with{" "}
        <span className="font-semibold">Next.js, Supabase, and Redis</span>, it
        focuses on speed, reliability, and user privacy.
      </p>

      {/* ... other content ... */}

      <div className="mt-8">
        <Link
          href="https://github.com/sumedhcharjan/Track-Vault.git"
          target="_blank"
          className="px-6 py-3 rounded-lg bg-gray-900 text-white font-medium hover:bg-gray-800 transition"
        >
          View Project on GitHub
        </Link>
      </div>
    </main>
  )
}
```
The "About" page highlights the core values of "secure and lightweight file sharing" and "privacy-first sharing," which directly influences the decision to use a robust authentication solution like KindeAuth. The mention of Next.js, Supabase, and Redis also provides context for the overall technology stack chosen for security and performance.
[View on GitHub](https://github.com/sumedhcharjan/Track-Vault/blob/main/src/app/about/page.jsx)

## Key Integration Points

### Seamless User Experience with KindeAuth

KindeAuth simplifies the user authentication journey by abstracting away the complexities of login forms, password resets, and multi-factor authentication. By integrating `KindeProvider` on the client and `handleAuth` on the server, developers can provide a secure and familiar authentication experience with minimal effort. This approach reduces the burden of managing authentication infrastructure and allows focus on core application features.

### Robust User Data Management

The `api/register` route is a critical bridge between KindeAuth's identity management and Supabase's data persistence. This ensures that user metadata (email, name, Kinde user ID) is consistently stored and available for application-specific logic, such as associating files with a user or managing user permissions. The `upsert` mechanism with `onConflict: "email"` is a best practice to handle both new registrations and returning users efficiently, preventing data duplication.

### Security and Privacy Considerations

The choice of KindeAuth, coupled with Supabase for data storage, reflects a commitment to security and user privacy. KindeAuth handles sensitive authentication details, reducing the application's attack surface. Supabase, as a secure backend-as-a-service, further protects user data. The "About" page explicitly states the project's focus on "privacy-first sharing," reinforcing the importance of robust authentication and secure data handling in Track Vault. Utilizing server-side sessions via `getKindeServerSession` ensures that user identity is verified securely on the backend before sensitive operations or data storage occur.