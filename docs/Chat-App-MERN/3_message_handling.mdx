---
title: "Message Handling API"
description: "Details on message sending, retrieval, and real-time updates."
---
# Message Handling API

<TOC />

This section describes the API endpoints for sending and receiving messages, along with the real-time functionality implemented using Socket.IO.  The core logic resides in [`backend/src/controllers/message.controller.js`](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/controllers/message.controller.js).

## API Endpoints

### Getting Users for Sidebar

The `/getUsersForSidebar` endpoint retrieves a list of users excluding the currently logged-in user, intended for populating a user sidebar in the frontend.

### Getting Messages

The `/getMessages/:id` endpoint retrieves messages between the currently logged-in user and the user identified by `:id`.


### Sending Messages

The `/sendMessage/:id` endpoint allows users to send messages to a specific recipient.  The endpoint accepts text and optionally an image. Image uploads are handled using Cloudinary.


```javascript
// Snippet from backend/src/controllers/message.controller.js
export const sendMessage = async (req, res) => {
    try {
        const { text, image } = req.body;
        const { id: receiverId } = req.params;
        const senderId = req.user._id;
        // ...rest of the function...
    } catch (error) {
        // ...error handling...
    }
};
```

## Real-time Updates with Socket.IO

The application uses Socket.IO for real-time message updates. When a new message is sent, Socket.IO emits a `newMessage` event to the recipient's socket.  The functions `getReceiverSocketId` and `io` manage socket connections (see [`backend/src/lib/socket.js`](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/lib/socket.js)).


````mermaid
sequenceDiagram
    participant UserA
    participant Server
    participant UserB
    UserA->>Server: Send Message
    activate Server
    Server->>UserB: newMessage event
    deactivate Server
```


GLOBAL_TOC_PLACEHOLDER: 1. Overview, 2. Friend Management, 3. Message Handling, 4. Authentication, 5. Database, 6. Image Handling