---
title: "Backend Development"
description: "Details on the server-side architecture and implementation."
---

# Backend Development

<TOC />

## 1. Project Overview

This document details the backend architecture of the application.  The backend is built using Node.js with Express.js as the web framework.  It utilizes MongoDB for persistent data storage and incorporates authentication via email and Google OAuth. Real-time communication is facilitated using Socket.IO.

The project's structure is organized as follows:

````mermaid
graph TD
    A[backend] --> B(package.json);
    A --> C(src);
    C --> D(index.js);
    C --> E(lib);
    E --> F(db.js);
    E --> G(socket.js);
    E --> H(passport.config.js);
    C --> I(models);
    I --> J(user.model.js);
    C --> K(routes);
    K --> L(auth.route.js);
    K --> M(message.route.js);
    K --> N(friend.route.js);
    C --> O(controllers);
    C --> P(middleware);

```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend)


## 2. Dependencies

The `package.json` file lists all project dependencies and devDependencies.

```json
{
  "dependencies": {
    "bcryptjs": "^2.4.3",
    "cloudinary": "^2.5.1",
    "cookie-parser": "^1.4.7",
    "dotenv": "^16.4.7",
    "express": "^4.21.2",
    "express-session": "^1.18.1",
    "jsonwebtoken": "^9.0.2",
    "mongoose": "^8.9.5",
    "passport": "^0.7.0",
    "passport-google-oauth20": "^2.0.0",
    "socket.io": "^4.8.1"
  },
  "devDependencies": {
    "nodemon": "^3.1.9"
  }
}
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/package.json)

*   **`bcryptjs`**: For password hashing.
*   **`cloudinary`**: For image uploading and storage.
*   **`cookie-parser`**: For parsing cookies.
*   **`dotenv`**: For loading environment variables.
*   **`express`**: The core web framework.
*   **`express-session`**: For managing user sessions.
*   **`jsonwebtoken`**: For creating and verifying JWTs (JSON Web Tokens).
*   **`mongoose`**: ODM (Object Data Modeling) for MongoDB.
*   **`passport`**: Authentication middleware.
*   **`passport-google-oauth20`**:  For Google OAuth authentication.
*   **`socket.io`**: For real-time communication.
*   **`nodemon`**:  For automatic restarts during development.

## 3. Server Setup and Initialization (`index.js`)

The `index.js` file sets up the Express.js server, initializes middleware, configures routes, and starts the Socket.IO server.

```javascript
import express from "express";
import cors from "cors";
import authRoutes from "./routes/auth.route.js";
// ... other imports

const app = express();
// ... middleware setup (cors, json, urlencoded, session, passport)

app.use("/api/auth", authRoutes);
// ... other route definitions

const PORT = process.env.PORT;
server.listen(PORT, () => {
    console.log("server is running on PORT: " + String(PORT));
    connectDB();
});
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/index.js)

The server uses middleware for:

*   **`cors`**: Enables Cross-Origin Resource Sharing, allowing requests from a different origin (e.g., frontend).
*   **`express.json()` and `express.urlencoded()`**: Parses JSON and URL-encoded request bodies.
*   **`session`**: Manages user sessions using cookies.
*   **`passport`**: Handles authentication.

The code also connects to the database using `connectDB()` and starts listening on the specified port.  Production deployment includes serving static files from the frontend build directory.


## 4. User Model (`user.model.js`)

The `user.model.js` file defines the schema for the `User` model in MongoDB.

```javascript
import mongoose from "mongoose";

const userSchema = new mongoose.Schema({
    email: { type: String, required: true, unique: true },
    username: { type: String, required: true, unique: true, trim: true, minlength: 3, maxlength: 20 },
    password: { type: String, minlength: 6 },
    profilePic: { type: String, default: "" },
    friends: [{ type: mongoose.Schema.Types.ObjectId, ref: "User", default: [] }],
    friendRequests: [{ type: mongoose.Schema.Types.ObjectId, ref: "User", default: [] }],
    sentRequests: [{ type: mongoose.Schema.Types.ObjectId, ref: "User", default: [] }],
    authProvider: { type: String, enum: ['email', 'google'], default: 'email' },
    googleId: { type: String, unique: true, sparse: true }
}, { timestamps: true });

const User = mongoose.model("User", userSchema);
export default User;
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/models/user.model.js)

This schema includes fields for email, username, password, profile picture, friends list, friend requests, and Google OAuth integration.  The `timestamps` option automatically adds createdAt and updatedAt fields. A pre-save middleware handles password management for Google OAuth users.


## 5. Authentication Routes (`auth.route.js`)

The `auth.route.js` file defines the routes for authentication functionalities.

```javascript
import express from "express";
import passport from 'passport';
import { login, logout, signup, updateProfile, checkAuth, googleAuthCallback, checkUsernameAvailability } from "../controllers/auth.controller.js";
import { protectRoute } from "../middleware/auth.middleware.js";

const router = express.Router();

router.post("/signup", signup);
router.post("/login", login);
router.post("/logout", logout);
router.put("/update-profile", protectRoute, updateProfile);
router.get("/username/check/:username", protectRoute, checkUsernameAvailability);
router.get("/check", protectRoute, checkAuth);

router.get('/google', passport.authenticate('google', { scope: ['profile', 'email'] }));
router.get('/google/callback', passport.authenticate('google', { failureRedirect: 'http://localhost:5173/login', failureMessage: true }), googleAuthCallback);

export default router;
```

[Source](https://github.com/shinymack/Chat-App-MERN/blob/main/backend/src/routes/auth.route.js)


This file defines routes for signup, login, logout, profile update, username availability check, authentication check, and Google OAuth.  `protectRoute` middleware ensures only authenticated users can access certain routes.

````mermaid
sequenceDiagram
    participant Client
    participant Server
    Client->>Server: Signup Request
    activate Server
    Server->>Server: Create User
    Server-->>Client: Success/Failure
    deactivate Server
    Client->>Server: Login Request
    activate Server
    Server->>Server: Authenticate User
    Server-->>Client: Token/Error
    deactivate Server
    Client->>Server: Protected Route Request
    activate Server
    Server->>Server: Verify Token
    Server-->>Client: Resource/Error
    deactivate Server

```

Next: [Backend APIs](./2.1_backend_apis.mdx)